
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <meta name="description" content="Fast test runner for node">
    <meta name="author" content="Daniel Lundin">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="no-class.min.css">
  </head>
  <body>
    <main>
<h1 id="kuta">kuta</h1><p><a href="https://travis-ci.org/daniel-lundin/kuta"><img src="https://travis-ci.org/daniel-lundin/kuta.svg?branch=master" alt="Build Status"></a>
<a href="https://codeclimate.com/github/daniel-lundin/kuta"><img src="https://codeclimate.com/github/daniel-lundin/kuta/badges/gpa.svg" alt="Code Climate"></a></p>
<p>Experimental parallel test runner for node (very much WIP)</p>
<p><code>npm install kuta</code></p>
<ul><li><a href=#design-goals>Design goals</a></li><li><a href=#implementation-details>Implementation details</a></li><li><a href=#trade-offs>Trade-offs</a></li><li><a href=#usage>Usage</a></li><li><a href=#writing-tests>Writing tests</a></li><li><a href=#running-tests>Running tests</a></li><li><a href=#configuration>Configuration</a></li><li><a href=#babel>Babel</a></li><li><a href=#parallel-processes>Parallel processes</a></li><li><a href=#mocha-compatibility>Mocha compatibility</a></li><li><a href=#mocha-cakes>Mocha cakes</a></li><li><a href=#extras>Extras</a></li></ul><h2 id="design-goals">Design goals</h2><ul>
<li>Fast execution times by running tests in parallel</li>
<li>Agnostic towards assertion libraries, as long as exceptions are thrown.</li>
<li>Small API, few features, little configuration</li>
</ul>
<h2 id="implementation-details">Implementation details</h2><ul>
<li>Run each test file in it&#39;s own process, but recycle processes through a process pool.</li>
</ul>
<h2 id="trade-offs">Trade-offs</h2><ul>
<li>No TAP support(files are run one by one, so total number of tests are unknown)</li>
<li>Processes are reused which means that test clean up has to be done for each test. If one test &quot;leaks&quot; into another it can be hard to debug since it is not deterministic which process will run which test.</li>
</ul>
<h2 id="usage">Usage</h2><h3 id="writing-tests">Writing tests</h3><pre><code class="lang-js">import { test } from &#39;kuta&#39;;

test.before(() =&gt; {
  // Some setup
});

test.after(() =&gt; {
  // Some tear down
});

test.beforeEach(() =&gt; {
  // Will run before each test
});

test.afterEach(() =&gt; {
  // Will run after each test
});

// Synchronous test
test(&#39;it should work&#39;, () =&gt; {
  assert(true);
});

// Asynchronous test (return a promise)
test(&#39;it should work&#39;, () =&gt; {
  return fetch(&#39;http://url.se&#39;)
    .then((response) =&gt; {
      assert(response.ok);
    });
});

//  Grouped tests
test.group(&#39;a group&#39;, (t) =&gt; {
  t.before(() =&gt; {
    // Will run before tests in group
  });

  t.after(() =&gt; {
    // Will run after tests in group
  });

  t(&#39;a test in this group&#39;, () =&gt; {});
});
</code></pre>
<h3 id="running-tests">Running tests</h3><p>Tests are run with the kuta command:</p>
<pre><code>  Usage: kuta [options] testfiles

  Options:
   -r, --require            Files to require before running tests
   -p, --processes          Number of processes in the process pool
   -t, --timeout            Number of milliseconds before tests timeout
       --reporter           progress or spec(default)
   -w, --watch [dir1,dir2]  Directories to watch for changes and re-run tests
</code></pre><p>Example:</p>
<p><code>kuta tests/**/*.js</code></p>
<h3 id="configuration">Configuration</h3><p>Kuta looks for a <code>kuta</code>-section in package.json where options can be defined. CLI arguments take precendence over package.json config.</p>
<p>Example package.json:</p>
<pre><code class="lang-json">{
  &quot;name&quot;: &quot;my-app&quot;,
  &quot;kuta&quot;: {
    &quot;requires&quot;: [&quot;testSetup.js&quot;, &quot;babel-register&quot;],
    &quot;files&quot;: [&quot;tests/*.js&quot;],
    &quot;processes&quot;: 8,
    &quot;watch&quot;: &quot;lib/,common&quot;,
    &quot;timeout&quot;: 1000
  },
}
</code></pre>
<h3 id="babel">Babel</h3><p>If you transpile with babel, use the babel-register hook:</p>
<p><code>kuta tests/**/*.js --require babel-register</code></p>
<h3 id="parallel-processes">Parallel processes</h3><p>Since processes are run in parallel, test that spawn services on specific port will run into problems where two processes try to allocate the same port. To overcome this, kuta sends an environment variable with an index to each of the process that can be used to generate unique ports for different processes.</p>
<p>The environment variable is <code>KUTA_PROCESS_INDEX</code></p>
<h2 id="mocha-compatibility">Mocha compatibility</h2><p>Kuta includes a mocha and mocha-cakes compatability layer:</p>
<pre><code class="lang-js">
import { describe, it } from &#39;kuta/lib/mocha-compat&#39;;

describe(&#39;mocha style&#39;, () =&gt; {
  before(() =&gt; {});
  after(() =&gt; {});

  it(&#39;should work&#39;, () =&gt; {
    describe(&#39;inner group&#39;, () =&gt; {
    });
  });
});
</code></pre>
<h3 id="mocha-cakes">Mocha cakes</h3><pre><code class="lang-js">
import { Feature, Scenario, Given, When, Then, But } from &#39;kuta/lib/mocha-compat&#39;;

Feature(&#39;Feature&#39;, () =&gt; {
  Scenario(&#39;&#39;, () =&gt; {
    Given(&#39;a given&#39;, () =&gt; {});

    When(&#39;something happens&#39;, () =&gt; {});

    Then(&#39;something is expected&#39;, () =&gt; {});

    And(&#39;another thing should be expected&#39;, () =&gt; {});

    But(&#39;not this thing&#39;, () =&gt; {});
  });
});
</code></pre>
<h2 id="extras">Extras</h2><p>BDD syntax add-on for writing test in given-when-then style:</p>
<pre><code class="lang-js">
import { feature } from &#39;kuta/lib/bdd&#39;;

feature(&#39;a feature&#39;, (scenario) =&gt; {
  scenario(&#39;a scenario&#39;, ({ given, when, then }) =&gt; {
    given(&#39;something given&#39;, () =&gt; {
      // Some setup
    });

    when(&#39;something happens&#39;, () =&gt; {
     // Some acting
    });

    then(&#39;something is expected&#39;, () =&gt; {
     // Some expecting
    });
  });
});
</code></pre>
<p>Also included is a Jasmine-like DSL:</p>
<pre><code class="lang-js">
import { describe } from &#39;kuta/lib/bdd&#39;;

describe(&#39;outer describe&#39;, (it) =&gt; {
  it.before(() =&gt; {
    // Will run before all inner describes
  });

  it.after(() =&gt; {
    // Will run after all inner describes
  });

  it.describe(&#39;inner describe&#39;, (it) =&gt; {
    it(&#39;some test&#39;, () =&gt; {
      // test setup
    });
  });
});
</code></pre>

    </main>
  </body>
</html>
